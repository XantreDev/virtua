import{j as I}from"./jsx-runtime-c3d7f245.js";import{r as d}from"./index-c6dae603.js";import{s as be}from"./index-778f7dbf.js";const N=Math.min,U=Math.max,_e=Math.abs,se=Date.now,W=e=>e!=null,le=(e,t)=>Array.from({length:e},(n,o)=>t(o)),X=(e,t)=>{const n=e.t[t];return n===-1?e.o:n},me=(e,t,n)=>{if(!e.l)return 0;if(e.i>=t)return n?e.u[t]+X(e,t):e.u[t];let o=e.i,i=e.u[o];for(;o<=t&&(e.u[o]=i,o!==t||n);)i+=X(e,o),o++;return e.i=t,i},ie=(e,t)=>me(e,t),pe=(e,t,n)=>{let o=0;if(n>=0)for(;t<e.l-1;){const i=X(e,t++);if((o+=i)>=n){o-i/2>=n&&t--;break}}else for(;t>0;){const i=X(e,--t);if((o-=i)<=n){o+i/2<n&&t++;break}}return N(U(t,0),e.l-1)},ce=(e,t,n,o)=>pe(e,n,t-o),ue=pe,ae=(e,t,n)=>({o:t,l:e,i:n?N(n.i,e-1):0,t:le(e,o=>{const i=n&&n.t[o];return W(i)?i:-1}),u:le(e,o=>{if(o===0)return 0;const i=n&&n.u[o];return W(i)?i:-1})}),P=typeof window<"u"?d.useLayoutEffect:d.useEffect,B=(e,t)=>be.useSyncExternalStore(e,t,t),_="current",de=e=>{const t=d.useRef();return t[_]||(t[_]=e())},fe=e=>{const t=d.useRef(e);return P(()=>{t[_]=e},[e]),d.useCallback((...n)=>{t[_]&&t[_](...n)},[])},xe=d.memo(({_:e,h:t,m:n,g:o,p:i})=>{const v=d.useRef(null),V=B(n.S,()=>n.I(o)),x=B(n.S,()=>n.v(o));return P(()=>t.T(v[_],o),[o]),I(i,{ref:v,style:d.useMemo(()=>{const M=n.O(),j=n.R()?"right":"left",D={margin:0,padding:0,position:"absolute",[M?"height":"width"]:"100%",[M?"top":j]:0,[M?j:"top"]:V};return M&&(D.display="flex"),x&&(D.visibility="hidden"),D},[V,x]),children:e})}),Me=d.forwardRef(({children:e,style:t,scrollSize:n,scrolling:o,horizontal:i,rtl:v},V)=>I("div",{ref:V,style:t,children:I("div",{style:d.useMemo(()=>{const x=i?n:"100%",M=i?"100%":n;return{position:"absolute",top:0,[v?"right":"left"]:0,width:x,height:M,minWidth:x,minHeight:M,pointerEvents:o?"none":"auto"}},[n,o]),children:e})})),Te=({_:e,M:t,m:n,p:o,k:i,j:v})=>{const V=B(n.S,n.A),x=n.O();return I(o,{ref:t,scrollSize:V,scrolling:i,horizontal:x,rtl:n.R(),style:d.useMemo(()=>({overflow:x?"auto hidden":"hidden auto",position:"relative",contain:"strict",width:"100%",height:"100%",padding:0,margin:0,...v}),[v]),children:e})},Ve=d.forwardRef(({children:e,itemSize:t=40,overscan:n=4,horizontal:o,rtl:i,endThreshold:v=0,style:V,element:x=Me,itemElement:M="div",onEndReached:j,onScroll:D,onScrollStop:ge},ve)=>{const Y=d.useMemo(()=>{const r=[];return d.Children.forEach(e,y=>{(E=>!W(E)||typeof E=="boolean")(y)||r.push(y)}),r},[e]),F=Y.length,R=de(()=>((r,y,E,J)=>{let h,k=0,T=0,S=0,A=[],f=ae(r,y),C=[0,0];const b=new Set,H=()=>E?k:T;return{D(){const[u,p]=C,g=ie(f,u),s=ce(f,S,u,g),c=ue(f,s,H());return u===s&&p===c?C:C=[s,c]},v:u=>f.t[u]===-1,F:u=>((p,g,s)=>{for(let c=g;c<=s;c++)if(p.t[c]===-1)return!0;return!1})(f,u,ue(f,u,H())),I:u=>ie(f,u),H:()=>S,J:()=>H(),A:()=>(u=>me(u,u.l-1,!0))(f),P:()=>f.l,U:()=>A,O:()=>E,R:()=>J,W:u=>ce(f,u,0,0),C:()=>(h&&h[1](),new Promise((u,p)=>{h=[()=>{Promise.resolve().then(()=>{u(),h=void 0})},p]})),S:u=>(b.add(u),()=>{b.delete(u)}),L(u,p){(()=>{switch(u){case 0:return f.l!==p&&(f=ae(p,y,f),!0);case 1:{const g=p.filter(([c,l])=>f.t[c]!==l);if(!g.length)return!1;const s=[];return g.forEach(([c,l])=>{s.push([c,l-X(f,c)]),((a,w,L)=>{a.t[w]=L,a.i=N(w,a.i)})(f,c,l)}),A=s,!0}case 2:return(k!==p.V||T!==p.q)&&(k=p.V,T=p.q,!0);case 3:{const g=S;return(S=p)!==g}}})()&&(b.forEach(g=>{g()}),h&&u===1&&h[0]())}}})(F,t,!!o,!!i)),[te,Q]=B(R.S,R.D),Z=B(R.S,R.U),ne=d.useRef(null),G=d.useRef(-1),ye=fe(D),we=fe(ge),[$,Se]=d.useState(new Set),[Re,Ee]=d.useState(!1),O=de(()=>((r,y,E)=>{let J,h,k,T=-1,S=0,A=!1;const f=r.O(),C=r.R(),b=f?"scrollLeft":"scrollTop",H=new WeakMap,u=()=>k||(k=new ResizeObserver(s=>{const c=[];for(const l of s)if(l.target===h)r.L(2,{V:l.contentRect.width,q:l.contentRect.height});else{const a=H.get(l.target);W(a)&&c.push([a,l.contentRect[f?"width":"height"]])}c.length&&(r.L(1,c),A=!0)})),p=()=>h?r.O()?h.scrollWidth:h.scrollHeight:0,g=(s,c)=>{if(h){if(C){if(!W(J)){const l=h[b];h[b]=1,J=h[b]===0,h[b]=l}J&&(s*=-1)}c?h[b]+=s:(h[b]=s,S=3)}};return{B(s){h=s;const c=u(),l=()=>{let m=s[b];C&&(m=_e(m)),T!==m&&(S!==0&&A?A=!1:S!==3&&(S=T>m?2:1),r.L(3,T=m),y(m))},a=(()=>{let m;const q=()=>{W(m)&&clearTimeout(m)},K=()=>{q(),m=setTimeout(()=>{m=null,l(),S=0,E(!1)},150)};return K.G=q,K})(),w=()=>{const m=S===0;l(),m&&E(!0),a()},L=(()=>{let m=se()-50;return(...q)=>{const K=se();m+50<K&&(m=K,(ee=>{S!==0&&(ee.ctrlKey||(f?ee.deltaX:ee.deltaY)&&T>0&&T<r.A()-r.J()&&a())})(...q))}})();return c.observe(s),s.addEventListener("scroll",w),s.addEventListener("wheel",L,{passive:!0}),()=>{c.disconnect(),s.removeEventListener("scroll",w),s.removeEventListener("wheel",L),a.G()}},T(s,c){const l=u();return H.set(s,c),l.observe(s),()=>{H.delete(s),l.unobserve(s)}},K:p,N:async(s,c)=>{const l=()=>{let a=c();const w=p(),L=r.J();return w-(a+L)<=0&&(a=w-L),a};if(r.F(s)){do{r.L(3,l());try{await r.C()}catch{return}}while(r.F(s));g(l())}else{const a=l();g(a),r.L(3,a)}},X:(s,c)=>{if(S===2){const l=s.reduce((a,[,w])=>a+w,0);l&&g(l,!0)}else if(S===3){const l=r.H();if(l!==0){const a=s.reduce((w,[,L])=>w+L,0);if(r.A()-(l+r.J()+a)<=0)a&&g(l+a);else{const w=s.reduce((L,[m,q])=>(m<c&&(L+=q),L),0);w&&g(w,!0)}}}}}})(R,ye,r=>{Ee(r),r||(Se(new Set),we())})),z=N(F,R.P());P(()=>{R.L(0,F)},[F]),P(()=>O.B(ne[_]),[]),P(()=>{Z.length&&O.X(Z,te)},[Z]),d.useEffect(()=>{j&&(G[_]>z&&(G[_]=-1),z-1-Q<=v&&G[_]<z&&(G[_]=z,j()))},[Q]),d.useImperativeHandle(ve,()=>({get scrollOffset(){return R.H()},get scrollSize(){return O.K()},scrollToIndex(r){r=U(N(r,z-1),0),O.N(r,()=>R.I(r))},scrollToOffset(r){r=U(r,0),O.N(R.W(r),()=>r)}}),[z]);const re=U(te-n,0),oe=N(Q+n,z-1),Le=d.useMemo(()=>{const r=[];for(let y=re;y<=oe;y++)$.add(y);return $.forEach(y=>{const E=Y[y];r.push(I(xe,{h:O,m:R,g:y,p:M,_:E},(E==null?void 0:E.key)||y))}),r},[Y,$,re,oe]);return I(Te,{M:ne,m:R,p:x,k:Re,j:V,_:Le})}),he=d.memo(({count:e,Component:t,handle:n})=>{const o=d.useRef(null);return d.useImperativeHandle(n,()=>({scrollToIndex:i=>{var v;(v=o.current)==null||v.scrollToIndex(i)}})),I(Ve,{ref:o,children:Array.from({length:e}).map((i,v)=>I(t,{index:v},v))})});try{he.displayName="VirtuaList",he.__docgenInfo={description:"",displayName:"VirtuaList",props:{count:{defaultValue:null,description:"",name:"count",required:!0,type:{name:"number"}},Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"ForwardRefExoticComponent<{ index: number; } & RefAttributes<HTMLDivElement>>"}},handle:{defaultValue:null,description:"",name:"handle",required:!1,type:{name:"Ref<ListHandle>"}}}}}catch{}export{he as V};
//# sourceMappingURL=virtua-474e3f0e.js.map
