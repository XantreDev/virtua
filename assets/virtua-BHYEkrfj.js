import{j as _}from"./jsx-runtime-DuyR_K1q.js";import{r as b}from"./index-yUhCOHB4.js";import{r as ge}from"./index-CDi3QEc7.js";const O=Math.min,B=Math.max,oe=Math.abs,xe=Array.isArray,ee=setTimeout,ne=(e,t,n)=>O(n,B(t,e)),Q=e=>e!=null,ue=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)},re=e=>{let t,n;return(...r)=>(t||(t=!0,n=e(...r)),n)},H=-1,K=(e,t,n)=>{const r=n?"unshift":"push";for(let s=0;s<t;s++)e[r](H);return e},q=(e,t)=>{const n=e.t[t];return n===H?e.o:n},we=(e,t,n)=>{const r=e.t[t]===H;return e.t[t]=n,e.i=O(t,e.i),r},te=(e,t)=>{if(!e.l)return 0;if(e.i>=t)return e.u[t];e.i<0&&(e.u[0]=0,e.i=0);let n=e.i,r=e.u[n];for(;n<t;)r+=q(e,n),e.u[++n]=r;return e.i=t,r},se=(e,t,n)=>{let r=te(e,n);for(;n>=0&&n<e.l;)if(r<=t){const s=q(e,n);if(r+s>t)break;r+=s,n++}else r-=q(e,--n);return ne(n,0,e.l-1)},ie=(e,t,n,r)=>{const s=se(e,t,O(n,e.l-1));return[s,se(e,t+r,s)]},le=(e,t,n)=>{const r=t-e.l;let s;return r>0?(s=e.o*r,K(e.t,r,n),K(e.u,r)):(s=-(n?e.t.splice(0,-r):e.t.splice(r)).reduce((l,c)=>l+(c===H?e.o:c),0),e.u.splice(r)),e.i=n?-1:O(t-1,e.i),e.l=t,s},ae=typeof window<"u",de=()=>document.documentElement,be=e=>e.ownerDocument,Re=e=>e.defaultView,fe=re(()=>!!ae&&getComputedStyle(de()).direction==="rtl"),he=re(()=>/iP(hone|od|ad)/.test(navigator.userAgent)),ke=re(()=>"scrollBehavior"in de().style),Ee=e=>B(e.h(),e._()),Se=(e,t,n)=>(n!==1&&(e-=B(0,t)),B(e,0)),Le=(e,t,n,r)=>(n!==2&&(e+=B(0,t)),O(e,r-1)),Te=(e,t=40,n=0,r,s=!1,l=0,c=0)=>{let d=!!n,o=[],i=0,u=0,h=0,f=0,w=0,C=!1,L=0,m=0,R=0,p=d?[0,B(n-1,0)]:null,I=[0,0],W=0;const y=r||((a,k)=>({o:k,l:a,i:-1,t:K([],a),u:K([],a)}))(e,t),J=new Set,g=()=>(a=>a.l?te(a,a.l-1)+q(a,a.l-1):0)(y),P=()=>g()+l+c,z=()=>B(0,P()-i),V=a=>te(y,a)-w,Y=a=>{a&&(he()&&m!==0?w+=a:(f+=a,h++))};return{p:()=>o,v:()=>JSON.parse(JSON.stringify(y)),m:()=>p?[O(I[0],p[0]),B(I[1],p[1])]:L?I:I=ie(y,u-l+w+f,I[0],i),S:a=>y.t[a]===H,I:()=>!!p&&y.t.slice(B(0,p[0]-1),O(y.l-1,p[1]+1)+1).includes(H),R:V,k:a=>q(y,a),C:()=>y.l,M:()=>u,T:()=>m,_:()=>i,H:()=>l,h:g,J:()=>h,O(){const a=f,k=C;return f=0,C=!1,i>P()?[0,!1]:[L=a,k]},W(a,k){const D=[a,k];return J.add(D),()=>{J.delete(D)}},B(a,k){let D,$,T=0;switch(a){case 1:{const M=k.filter(([x,S])=>y.t[x]!==S);if(!M.length)break;let v=!1,E=!1;R===2?u>z()-1.5&&(E=!0):v=!0,Y(M.reduce((x,[S,A])=>{if(!v||V(S)<u){const N=A-q(y,S);(!E||N>0)&&(x+=N)}return x},0));for(const[x,S]of M){const A=q(y,x),N=we(y,x,S);s&&(W+=S,N||(W-=A))}s&&i&&W>i&&(Y(((x,S)=>{let A=0;const N=x.t.filter((F,X)=>{const U=F!==H;return U&&X<S&&A++,U}),pe=x.o;return x.i=-1,((x.o=(F=>{const X=[...F].sort((ve,ye)=>ve-ye),U=F.length/2|0;return X.length%2==0?(X[U-1]+X[U])/2:X[U]})(N))-pe)*B(S-A,0)})(y,I[0])),s=!1),T=2,$=!0;break}case 2:i!==k&&(i=k,T=2);break;case 3:k[1]?(Y(le(y,k[0],!0)),R=2,C=!0,T=1):le(y,k[0]);break;case 4:{const M=ne(k,0,z()),v=L;if(L=0,M===u)break;const E=M-u,x=oe(E);v&&x<oe(v)+1||R!==0||(m=E<0?2:1),d&&(p=null,d=!1),$=x>i,u=M,T=5;break}case 5:T=8,m!==0&&(D=!0,T+=1),m=0,R=0,p=null;break;case 6:R=1;break;case 7:p=ie(y,k,I[0],i),T=1}T&&(o=[],D&&w&&(f+=w,w=0,h++),J.forEach(([M,v])=>{T&M&&v($)}))}}},Z=ae?b.useLayoutEffect:b.useEffect,G=(e,t)=>t&&fe()?-e:e,Me=(e,t,n,r,s)=>{const l=Date.now;let c=0,d=!1,o=!1,i=!1,u=!1;const h=(()=>{let m;const R=()=>{Q(m)&&clearTimeout(m)},p=()=>{R(),m=ee(()=>{m=null,(()=>{if(d||o)return d=!1,void h();i=!1,e.B(5)})()},150)};return p.$=R,p})(),f=()=>{c=l(),i&&(u=!0),e.B(4,r()),h()},w=m=>{if(d||e.T()===0||m.ctrlKey)return;const R=l()-c;150>R&&50<R&&(n?m.deltaX:m.deltaY)&&(d=!0)},C=()=>{o=!0,i=u=!1},L=()=>{o=!1,he()&&(i=!0)};return t.addEventListener("scroll",f),t.addEventListener("wheel",w,{passive:!0}),t.addEventListener("touchstart",C,{passive:!0}),t.addEventListener("touchend",L,{passive:!0}),{A:()=>{t.removeEventListener("scroll",f),t.removeEventListener("wheel",w),t.removeEventListener("touchstart",C),t.removeEventListener("touchend",L),h.$()},D:()=>{const[m,R]=e.O();m&&(s(G(m,n),R,u),u=!1)}}},je=(e,t)=>{let n,r,s;const l=t?"scrollLeft":"scrollTop",c=t?"overflowX":"overflowY",d=async(o,i)=>{if(!n)return void ue(()=>d(o,i));s&&s();const u=()=>{let h;return[new Promise((f,w)=>{h=f,ee(s=w,150)}),e.W(2,()=>{h&&h()})]};if(i&&ke()){for(;e.B(7,o()),e.I();){const[h,f]=u();try{await h}catch{return}finally{f()}}n.scrollTo({[t?"left":"top"]:G(o(),t),behavior:"smooth"})}else for(;;){const[h,f]=u();try{n[l]=G(o(),t),e.B(6),await h}catch{return}finally{f()}}};return{L(o){n=o,r=Me(e,o,t,()=>G(o[l],t),(i,u,h)=>{if(h){const f=o.style,w=f[c];f[c]="hidden",ee(()=>{f[c]=w})}u?(o[l]=e.M()+i,s&&s()):o[l]+=i})},A(){r&&r.A()},P(o){d(()=>o)},V(o){o+=e.M(),d(()=>o)},X(o,{align:i,smooth:u}={}){if(o=ne(o,0,e.C()-1),i==="nearest"){const h=e.R(o),f=e.M();if(h<f)i="start";else{if(!(h+e.k(o)>f+e._()))return;i="end"}}d(()=>e.H()+(i==="end"?e.R(o)+e.k(o)-e._():i==="center"?e.R(o)+(e.k(o)-e._())/2:e.R(o)),u)},D:()=>{r&&r.D()}}},j="current",me=(e,t)=>{if(xe(e))for(const n of e)me(n,t);else Q(e)&&typeof e!="boolean"&&t.push(e)},Ae=(e,t)=>{const n=e.key;return Q(n)?n:"_"+t},Ce=e=>{const t=b.useRef();return t[j]||(t[j]=e())},ce=e=>{const t=b.useRef(e);return Z(()=>{t[j]=e},[e]),t},Ie=e=>{let t;return{L(n){(t||(t=new(Re(be(n))).ResizeObserver(e))).observe(n)},Y(n){t.unobserve(n)},A(){t&&t.disconnect()}}},Be=(e,t)=>{let n;const r=t?"width":"height",s=new WeakMap,l=Ie(c=>{const d=[];for(const{target:o,contentRect:i}of c)if(o.offsetParent)if(o===n)e.B(2,i[r]);else{const u=s.get(o);Q(u)&&d.push([u,i[r]])}d.length&&e.B(1,d)});return{j(c){l.L(n=c)},q:(c,d)=>(s.set(c,d),l.L(c),()=>{s.delete(c),l.Y(c)}),A:l.A}},ze=b.memo(({N:e,U:t,F:n,G:r,K:s,Z:l,ee:c,te:d})=>{const o=b.useRef(null);Z(()=>t(o[j],n),[n]);const i=b.useMemo(()=>{const u={margin:0,padding:0,position:s&&d?void 0:"absolute",[c?"height":"width"]:"100%",[c?"top":"left"]:0,[c?fe()?"right":"left":"top"]:r,visibility:!s||d?"visible":"hidden"};return c&&(u.display="flex"),u},[r,s,d]);return _.jsx(l,typeof l=="string"?{ref:o,style:i,children:e}:{ref:o,style:i,index:n,children:e})}),De=e=>b.useReducer(e.p,void 0,e.p)[1],_e=(e,t)=>b.useMemo(()=>{if(typeof e=="function")return[e,t||0];const n=(r=>{const s=[];return me(r,s),s})(e);return[r=>n[r],n.length]},[e,t]),qe=b.forwardRef(({children:e,count:t,overscan:n=4,itemSize:r,shift:s,horizontal:l,cache:c,startMargin:d,endMargin:o,ssrCount:i,as:u="div",item:h="div",scrollRef:f,onScroll:w,onScrollEnd:C,onRangeChange:L},m)=>{const[R,p]=_e(e,t),I=b.useRef(null),W=b.useRef(!!i),y=ce(w),J=ce(C),[g,P,z,V]=Ce(()=>{const v=!!l,E=Te(p,r,i,c,!r,d,o);return[E,Be(E,v),je(E,v),v]});p!==g.C()&&g.B(3,[p,s]);const Y=De(g),[a,k]=g.m(),D=g.T(),$=g.J(),T=g.h(),M=[];Z(()=>{W[j]=!1;const v=g.W(3,A=>{A?ge.flushSync(Y):Y()}),E=g.W(4,()=>{y[j]&&y[j](g.M())}),x=g.W(8,()=>{J[j]&&J[j]()}),S=A=>{P.j(A),z.L(A)};return f?ue(()=>S(f[j])):S(I[j].parentElement),()=>{v(),E(),x(),P.A(),z.A()}},[]),Z(()=>{z.D()},[$]),b.useEffect(()=>{L&&L(a,k)},[a,k]),b.useImperativeHandle(m,()=>({get cache(){return g.v()},get scrollOffset(){return g.M()},get scrollSize(){return Ee(g)},get viewportSize(){return g._()},scrollToIndex:z.X,scrollTo:z.P,scrollBy:z.V}),[]);for(let v=Se(a,n,D),E=Le(k,n,D,p);v<=E;v++){const x=R(v);M.push(_.jsx(ze,{U:P.q,F:v,G:g.R(v),K:g.S(v),Z:h,N:x,ee:V,te:W[j]},Ae(x,v)))}return _.jsx(u,{ref:I,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:V?T:"100%",height:V?"100%":T,pointerEvents:D!==0?"none":"auto"},children:M})}),He=b.forwardRef(({children:e,count:t,overscan:n,itemSize:r,shift:s,horizontal:l,reverse:c,cache:d,ssrCount:o,item:i,onScroll:u,onScrollEnd:h,onRangeChange:f,style:w,...C},L)=>{const m=b.useRef(null),R=c&&!l;let p=_.jsx(qe,{ref:L,scrollRef:R?m:void 0,count:t,overscan:n,itemSize:r,shift:s,horizontal:l,cache:d,ssrCount:o,item:i,onScroll:u,onScrollEnd:h,onRangeChange:f,children:e});return R&&(p=_.jsx("div",{style:{visibility:"hidden",display:"flex",flexDirection:"column",justifyContent:"flex-end",minHeight:"100%"},children:p})),_.jsx("div",{ref:m,...C,style:{display:l?"inline-block":"block",[l?"overflowX":"overflowY"]:"auto",contain:"strict",width:"100%",height:"100%",...w},children:p})}),Oe=b.memo(({count:e,Component:t,handle:n})=>{const r=b.useRef(null);return b.useImperativeHandle(n,()=>({scrollToIndex:s=>{var l;(l=r.current)==null||l.scrollToIndex(s)}})),_.jsx(He,{ref:r,children:Array.from({length:e}).map((s,l)=>_.jsx(t,{index:l},l))})});Oe.__docgenInfo={description:"",methods:[{name:"scrollToIndex",docblock:null,modifiers:[],params:[{name:"i",optional:!1,type:null}],returns:null}],displayName:"VirtuaList",props:{count:{required:!0,tsType:{name:"number"},description:""},Component:{required:!0,tsType:{name:"SimpleItem"},description:""},handle:{required:!1,tsType:{name:"Ref",elements:[{name:"signature",type:"object",raw:"{ scrollToIndex: (index: number) => void }",signature:{properties:[{key:"scrollToIndex",value:{name:"signature",type:"function",raw:"(index: number) => void",signature:{arguments:[{type:{name:"number"},name:"index"}],return:{name:"void"}},required:!0}}]}}],raw:"Ref<ListHandle>"},description:""}}};export{Oe as V};
